# Tangem Wallet Integration Architecture

## Current Hardware Wallet Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    Safe Android App                            │
├─────────────────────────────────────────────────────────────────┤
│  OwnerAddOptionsFragment                                        │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐     │
│  │  Imported   │  Generated  │   Ledger    │  Keystone   │     │
│  │   Wallet    │   Wallet    │   Wallet    │   Wallet    │     │
│  └─────────────┴─────────────┴─────────────┴─────────────┘     │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Owner.Type Enum                             │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐     │
│  │ IMPORTED(0) │GENERATED(1) │LEDGER_NANO_X│ KEYSTONE(3) │     │
│  │             │             │     (2)     │             │     │
│  └─────────────┴─────────────┴─────────────┴─────────────┘     │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                CredentialsRepository                            │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐     │
│  │saveOwner()  │saveOwnerGen │saveLedgerOwn│saveKeystone │     │
│  │             │erated()     │er()         │Owner()      │     │
│  └─────────────┴─────────────┴─────────────┴─────────────┘     │
└─────────────────────────────────────────────────────────────────┘
```

## Proposed Tangem Integration Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    Safe Android App                            │
├─────────────────────────────────────────────────────────────────┤
│  OwnerAddOptionsFragment                                        │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┬─────┐ │
│  │  Imported   │  Generated  │   Ledger    │  Keystone   │Tangem│ │
│  │   Wallet    │   Wallet    │   Wallet    │   Wallet    │Wallet│ │
│  └─────────────┴─────────────┴─────────────┴─────────────┴─────┘ │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Owner.Type Enum                             │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┬─────┐ │
│  │ IMPORTED(0) │GENERATED(1) │LEDGER_NANO_X│ KEYSTONE(3) │TANGEM│ │
│  │             │             │     (2)     │             │ (4) │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┴─────┘ │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                CredentialsRepository                            │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┬─────┐ │
│  │saveOwner()  │saveOwnerGen │saveLedgerOwn│saveKeystone │save │ │
│  │             │erated()     │er()         │Owner()      │Tangem│ │
│  └─────────────┴─────────────┴─────────────┴─────────────┴─────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## Communication Protocols Comparison

```
┌─────────────────────────────────────────────────────────────────┐
│                    Hardware Wallet Communication                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Ledger (BLE)           Keystone (QR)           Tangem (NFC)   │
│  ┌─────────────┐       ┌─────────────┐         ┌─────────────┐ │
│  │   Android   │       │   Android   │         │   Android   │ │
│  │     App     │       │     App     │         │     App     │ │
│  └─────────────┘       └─────────────┘         └─────────────┘ │
│         │                       │                       │       │
│    Bluetooth LE            QR Code Exchange         NFC Radio   │
│         │                       │                       │       │
│  ┌─────────────┐       ┌─────────────┐         ┌─────────────┐ │
│  │   Ledger    │       │  Keystone   │         │   Tangem    │ │
│  │  Nano X     │       │  Hardware   │         │    Card     │ │
│  │  Device     │       │   Wallet    │         │             │ │
│  └─────────────┘       └─────────────┘         └─────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Tangem Integration Components

```
┌─────────────────────────────────────────────────────────────────┐
│                    Tangem Integration Layer                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                TangemController                         │   │
│  │  ┌─────────────┬─────────────┬─────────────┐           │   │
│  │  │ scanCard()  │getAddress() │signTransaction()│       │   │
│  │  └─────────────┴─────────────┴─────────────┘           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                │                               │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                TangemSdk                                │   │
│  │  ┌─────────────┬─────────────┬─────────────┐           │   │
│  │  │   NFC       │   Card      │  Signature  │           │   │
│  │  │ Management  │ Operations  │ Generation  │           │   │
│  │  └─────────────┴─────────────┴─────────────┘           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                │                               │
│                                ▼                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                Android NFC                              │   │
│  │  ┌─────────────┬─────────────┬─────────────┐           │   │
│  │  │   NFC       │   Card      │   Security  │           │   │
│  │  │   Radio     │ Detection   │   Layer     │           │   │
│  │  └─────────────┴─────────────┴─────────────┘           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Signing Flow Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    Transaction Signing Flow                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   Owner     │    │   Owner     │    │   Owner     │        │
│  │ Selection   │───▶│   Type      │───▶│  Signing    │        │
│  │ Fragment    │    │ Detection   │    │  Fragment   │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│                                │                       │       │
│                                ▼                       ▼       │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │   Ledger    │    │  Keystone   │    │   Tangem    │        │
│  │   BLE       │    │     QR      │    │    NFC      │        │
│  │  Signing    │    │   Signing   │    │  Signing    │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│                                │                       │       │
│                                ▼                       ▼       │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐        │
│  │  Signature  │    │  Signature  │    │  Signature  │        │
│  │  Returned   │    │  Returned   │    │  Returned   │        │
│  └─────────────┘    └─────────────┘    └─────────────┘        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Implementation Phases

```
Phase 1: Foundation Setup
├── Add Tangem SDK dependency
├── Add NFC permissions
└── Update Owner.Type enum

Phase 2: Core Integration
├── Create TangemController
├── Add dependency injection
└── Update CredentialsRepository

Phase 3: UI Integration
├── Update OwnerAddOptionsFragment
├── Add navigation routes
└── Create Tangem fragments

Phase 4: Signing Integration
├── Update OwnerListViewModel
├── Create TangemSignViewModel
└── Implement signing flow

Phase 5: Resources
├── Add string resources
├── Add drawable resources
└── Add localization

Phase 6: Testing
├── Unit tests
├── Integration tests
└── UI tests
```
